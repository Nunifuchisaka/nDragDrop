!function(i,e){"use strict";e.nDragDrop=e.nDragDrop||{};function o(){console.count("Common"),p.$body=i("body"),p.$clones=i('<div id="ndd_clones"></div>'),p.$body.append(p.$clones)}var p={$current:{drag:null,drop:null}};nDragDrop.draggable=function(e){_.bindAll(this,"init","mousedown","mousemove","mouseup"),this.init(e)},nDragDrop.draggable.prototype.init=function(e){this.opts=i.extend({},e),console.group("nDragDrop.draggable init"),console.log(this.opts),console.groupEnd();this.status={drag:!1},this.vars={graspPosDiffX:0,graspPosDiffY:0},p.common=p.common||new o,this.$el=i(this.opts.el),this.$el.addClass("ndd_drag"),this.$clone,p.$body.on("mousedown.ndd_draggable",this.opts.el,this.mousedown),p.$body.on("mouseup.ndd_draggable",this.mouseup)},nDragDrop.draggable.prototype.mousedown=function(e){console.group("draggable mousedown"),p.$current.drag=i(e.currentTarget).parent().find(this.opts.el);var r=p.$current.drag.offset();console.log("elOffset",r),p.$clones.show().css({top:r.top,left:r.left}),console.group("set position"),p.$current.drag.each(function(e,o){var t=i(o),s=t.offset(),n=t.clone().css({top:s.top-r.top,left:s.left-r.left});p.$clones.append(n)}),console.groupEnd(),p.$current.drag.css("visibility","hidden"),this.vars.graspPosDiffX=r.left-e.pageX,this.vars.graspPosDiffY=r.top-e.pageY,console.log("X : "+this.vars.graspPosDiffX,"Y : "+this.vars.graspPosDiffY),p.$body.on("mousemove.ndd_draggable",this.mousemove),console.groupEnd()},nDragDrop.draggable.prototype.mousemove=function(e){p.$clones.css({top:e.pageY+this.vars.graspPosDiffY,left:e.pageX+this.vars.graspPosDiffX})},nDragDrop.draggable.prototype.mouseup=function(e){null!=p.$current.drag&&(console.group("mouseup"),p.$body.off("mousemove.ndd_draggable"),p.$clones.hide().empty(),p.$current.drag.css("visibility","visible"),p.$current.drag=null,console.groupEnd())},nDragDrop.droppable=function(e){_.bindAll(this,"init","mouseenter","mouseleave","mouseup"),this.init(e)},nDragDrop.droppable.prototype.init=function(e){this.opts=i.extend({},e),console.group("droppable init"),console.log(this.opts),p.common=p.common||new o,this.$el=i(this.opts.el),this.$el.addClass("ndd_drop").on({mouseenter:this.mouseenter,mouseleave:this.mouseleave,mouseup:this.mouseup}),console.groupEnd()},nDragDrop.droppable.prototype.mouseenter=function(e){null!=p.$current.drag&&(console.log("ndd.$current.drag",p.$current.drag),p.$current.drop=i(e.currentTarget),console.log("ndd.$current.drop",p.$current.drop),1!=p.$current.drag.closest(p.$current.drop).length&&p.$current.drop.addClass("ndd_drop_active"))},nDragDrop.droppable.prototype.mouseleave=function(e){null!=p.$current.drop&&(console.group("drop mouseleave"),p.$current.drop.removeClass("ndd_drop_active"),p.$current.drop=null,console.groupEnd())},nDragDrop.droppable.prototype.mouseup=function(e){null!=p.$current.drop&&(this.mouseleave(e),console.group("drop mouseup"),console.log("ndd.$current.drag",p.$current.drag),console.groupEnd())},e.nSelectable=function(e){_.bindAll(this,"init","mousedown","mousemove","mouseup"),this.init(e)},nSelectable.prototype.init=function(e){this.opts=i.extend({selectee:"> *",excluse:null},e),p.common=p.common||new o,console.group("nSelectable init"),this.vars={startPosX:0,startPosY:0},this.$selectee,this.$selected,this.$el=i(this.opts.el),p.$current.select=null,this.$helper=i('<div id="ndd_selectable_helper"><div></div></div>'),p.$body.on("mousedown.ndd_selectable",this.opts.el,this.mousedown),p.$body.on("mousemove.ndd_selectable",this.mousemove),p.$body.on("mouseup.ndd_selectable",this.mouseup),this.opts.excluse&&p.$body.on("mousedown",this.opts.excluse,this.excluse),console.groupEnd()},nSelectable.prototype.excluse=function(e){console.count("excluse"),e.preventDefault(),e.stopPropagation()},nSelectable.prototype.mousedown=function(e){console.count("selectable mousedown"),p.$current.select=i(e.currentTarget),console.log("ndd.$current.select",p.$current.select),this.vars.startPosX=e.pageX,this.vars.startPosY=e.pageY,p.$body.append(this.$helper),this.$helper.css({top:e.pageY,left:e.pageX,width:0,height:0}),this.$selectee=p.$current.select.find(this.opts.selectee),console.log("this.$selectee",this.$selectee)},nSelectable.prototype.mousemove=function(e){if(null!=p.$current.select){var o,s=this,t=this.vars.startPosX,n=this.vars.startPosY,r=e.pageX,l=e.pageY;r<t&&(o=r,r=t,t=o),l<n&&(o=l,l=n,n=o),this.$helper.css({left:t,top:n,width:r-t,height:l-n}),this.$selectee.each(function(e,o){var t=i(o);t[function(e,o){var t=e.get(0).getBoundingClientRect(),s=o.get(0).getBoundingClientRect();return!(t.right<s.left||t.left>s.right||t.bottom<s.top||t.top>s.bottom)}(t,s.$helper)?"addClass":"removeClass"]("ndd_selected")})}},nSelectable.prototype.mouseup=function(e){console.count("selectable mouseup"),p.$current.select=null,this.$helper.remove(),console.log("this.$helper",this.$helper)}}(jQuery,this,this.document);