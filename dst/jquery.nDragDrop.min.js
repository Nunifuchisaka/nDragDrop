!function(c,e,t){"use strict";e.nDragDrop=e.nDragDrop||{};function o(){console.count("Common"),l.$window=c(e),l.$document=c(t),l.$body=c("body"),l.drag.helper=c('<div id="ndd_drag_helper"></div>'),l.$body.append(l.drag.helper)}var l={drag:{helper:null},$clones:null,$current:{drag:null,drop:null,select:null},$last:{select:null}};nDragDrop.draggable=function(e){_.bindAll(this,"init","mousedown","mousemove","mouseup","dragstart","dragging"),this.init(e)},nDragDrop.draggable.prototype.init=function(e){this.opts=c.extend({distance:2,create:null,start:null,drag:null,stop:null},e),console.group("nDragDrop Draggable init"),console.log(this.opts),console.groupEnd();this.status={drag:!1},this.vars={graspPosDiffX:0,graspPosDiffY:0,mousedownPageX:0,mousedownPageY:0,mousemoveStack:0},l.common=l.common||new o,this.$el=c(this.opts.el),l.$body.on("mousedown.ndd_draggable",this.opts.el,this.mousedown),l.$body.on("mouseup.ndd_draggable",this.mouseup)},nDragDrop.draggable.prototype.dragstart=function(e){l.$body.off("mousemove.ndd_drag_mousemove");var n=l.$current.drag.offset();l.drag.helper.show().css({top:n.top,left:n.left}),l.$current.drag.each(function(e,t){var o=c(t),s=o.offset(),r=o.clone().css({top:s.top-n.top,left:s.left-n.left});l.drag.helper.append(r)}),l.$current.drag.css("visibility","hidden"),l.$body.on("mousemove.ndd_dragging",this.dragging),this.opts.start&&this.opts.start(e,{helper:l.drag.helper,offset:l.drag.helper.offset()})},nDragDrop.draggable.prototype.mousedown=function(e){l.$current.drag=c(e.currentTarget).parent().find(this.opts.el),this.vars.mousedownPageX=e.pageX,this.vars.mousedownPageY=e.pageY;var t=l.$current.drag.offset();this.vars.graspPosDiffX=t.left-e.pageX,this.vars.graspPosDiffY=t.top-e.pageY,l.$body.on("mousemove.ndd_drag_mousemove",this.mousemove)},nDragDrop.draggable.prototype.mousemove=function(e){this.vars.mousemoveStack++,this.vars.mousemoveStack>this.opts.distance&&(this.vars.mousemoveStack=0,this.dragstart(e))},nDragDrop.draggable.prototype.dragging=function(e){l.drag.helper.css({top:e.pageY+this.vars.graspPosDiffY,left:e.pageX+this.vars.graspPosDiffX}),this.opts.drag&&this.opts.drag(e,{helper:l.drag.helper,offset:l.drag.helper.offset()})},nDragDrop.draggable.prototype.mouseup=function(e){l.$body.off("mousemove.ndd_drag_mousemove"),null!=l.$current.drag&&(l.$body.off("mousemove.ndd_dragging"),l.$current.drag.css("visibility","visible"),this.opts.stop&&this.opts.stop(e,{helper:l.drag.helper,offset:l.drag.helper.offset()}),l.drag.helper.hide().empty(),l.$current.drag=null,this.status.drag=!1)},nDragDrop.droppable=function(e){_.bindAll(this,"init","mouseenter","mouseleave","mouseup"),this.init(e)},nDragDrop.droppable.prototype.init=function(e){this.opts=c.extend({create:null,over:null,out:null,drop:null},e),console.group("droppable init"),console.log(this.opts),l.common=l.common||new o,this.$el=c(this.opts.el),this.$el.addClass("ndd_drop").on({mouseenter:this.mouseenter,mouseleave:this.mouseleave,mouseup:this.mouseup}),console.groupEnd()},nDragDrop.droppable.prototype.mouseenter=function(e){null!=l.$current.drag&&(console.log("ndd.$current.drag",l.$current.drag),l.$current.drop=c(e.currentTarget),1!=l.$current.drag.closest(l.$current.drop).length&&(this.opts.over&&this.opts.over(e,{draggable:l.$current.drag,helper:l.drag.helper,offset:l.drag.helper.offset()}),l.$current.drop.addClass("ndd_drop_active")))},nDragDrop.droppable.prototype.mouseleave=function(e){null!=l.$current.drop&&(console.group("drop mouseleave"),l.$current.drop.removeClass("ndd_drop_active"),l.$current.drop=null,console.groupEnd(),this.opts.out&&this.opts.out(e,{draggable:l.$current.drag,helper:l.drag.helper,offset:l.drag.helper.offset()}))},nDragDrop.droppable.prototype.mouseup=function(e){null!=l.$current.drop&&(l.$current.drop.removeClass("ndd_drop_active"),l.$current.drop=null,this.opts.drop&&this.opts.drop(e,{draggable:l.$current.drag,helper:l.drag.helper,offset:l.drag.helper.offset()}))},e.nSelectable=function(e){_.bindAll(this,"init","click","mousedown","mousemove","mouseup","keydown"),this.init(e)},nSelectable.prototype.init=function(e){this.opts=c.extend({selectee:"> *",excluse:null},e),l.common=l.common||new o,console.group("nSelectable init"),this.vars={startPosX:0,startPosY:0},this.$selectee,this.$selected,this.$el=c(this.opts.el),this.$el.each(function(e,t){var o=c(t).find(".ndd_selected");console.log(e,t,o.length),o.last().addClass("ndd_pivot")}),this.$helper=c('<div id="ndd_selectable_helper"><div></div></div>'),l.$body.on("mousedown.ndd_selectable",this.opts.el,this.mousedown),l.$body.on("mousemove.ndd_selectable",this.mousemove),l.$body.on("mouseup.ndd_selectable",this.mouseup),l.$body.on("click.ndd_selectable",this.opts.el+" "+this.opts.selectee,this.click),this.opts.excluse&&l.$body.on("mousedown",this.opts.excluse,this.excluse),console.groupEnd()},nSelectable.prototype.click=function(e){console.group("click");var t=c(e.currentTarget),o=t.parents(this.opts.el),s=o.find(".ndd_pivot");if(console.log("currentTarget",e.currentTarget),e.ctrlKey||e.metaKey||e.shiftKey||o.find(".ndd_selected").not(t).removeClass("ndd_selected"),e.ctrlKey||e.metaKey)if(t.hasClass("ndd_selected")){if(t.removeClass("ndd_selected ndd_pivot"),0==(s=o.find(".ndd_pivot")).length){var r=t.next(".ndd_selected");if(0<r.length)r.addClass("ndd_pivot");else{var n=t.prev(".ndd_selected");0<r.length?n.addClass("ndd_pivot"):o.find(".ndd_selected").eq(0).addClass("ndd_pivot")}s=o.find(".ndd_pivot")}}else s.removeClass("ndd_pivot"),o.find(".ndd_tmp").removeClass("ndd_tmp"),t.addClass("ndd_selected ndd_pivot"),s=o.find(".ndd_pivot");else t.addClass("ndd_selected");if(e.shiftKey){o.find(".ndd_tmp").removeClass("ndd_tmp ndd_selected"),0==s.length&&(o.find(this.opts.selectee).eq(0).addClass("ndd_pivot"),s=o.find(".ndd_pivot"));var d=t.index(),l=s.index();console.log("current",d),console.log("pivot",l);for(var a=Math.max(d,l),i=Math.min(d,l),p=o.find(this.opts.selectee),u=i;u<=a;u++)p.eq(u).addClass("ndd_selected"),u!=l&&p.eq(u).addClass("ndd_tmp")}t.hasClass("ndd_selected")&&(e.shiftKey||(o.find(".ndd_pivot").removeClass("ndd_pivot"),t.addClass("ndd_pivot"))),console.groupEnd()},nSelectable.prototype.excluse=function(e){console.count("nSelectable excluse"),e.preventDefault(),e.stopPropagation()},nSelectable.prototype.mousedown=function(e){l.$current.select=c(e.currentTarget),this.vars.startPosX=e.pageX,this.vars.startPosY=e.pageY,l.$body.append(this.$helper),this.$helper.css({top:e.pageY,left:e.pageX,width:0,height:0}),this.$selectee=l.$current.select.find(this.opts.selectee)},nSelectable.prototype.mousemove=function(e){if(null!=l.$current.select){var t,s=this,o=this.vars.startPosX,r=this.vars.startPosY,n=e.pageX,d=e.pageY;n<o&&(t=n,n=o,o=t),d<r&&(t=d,d=r,r=t),this.$helper.css({left:o,top:r,width:n-o,height:d-r}),this.$selectee.each(function(e,t){var o=c(t);o[function(e,t){var o=e.get(0).getBoundingClientRect(),s=t.get(0).getBoundingClientRect();return!(o.right<s.left||o.left>s.right||o.bottom<s.top||o.top>s.bottom)}(o,s.$helper)?"addClass":"removeClass"]("ndd_selected")})}},nSelectable.prototype.mouseup=function(e){l.$current.select=null,this.$helper.remove()},nSelectable.prototype.keydown=function(e){return!1}}(jQuery,this,this.document);