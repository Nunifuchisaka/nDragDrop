!function(u,e){"use strict";e.nDragDrop=e.nDragDrop||{};function o(){console.count("Common"),i.$body=u("body"),i.$clones=u('<div id="ndd_clones"></div>'),i.$body.append(i.$clones)}var i={$current:{drag:null,drop:null}};nDragDrop.draggable=function(e){_.bindAll(this,"init","mousedown","mousemove","mouseup"),this.init(e)},nDragDrop.draggable.prototype.init=function(e){this.opts=u.extend({},e),console.group("nDragDrop.draggable init"),console.log(this.opts),console.groupEnd();this.status={drag:!1},this.vars={graspPosDiffX:0,graspPosDiffY:0},i.common=i.common||new o,this.$el=u(this.opts.el),this.$el.addClass("ndd_drag"),this.$clone,i.$body.on("mousedown.ndd_draggable",this.opts.el,this.mousedown),i.$body.on("mouseup.ndd_draggable",this.mouseup)},nDragDrop.draggable.prototype.mousedown=function(e){console.group("draggable mousedown"),i.$current.drag=u(e.currentTarget).parent().find(this.opts.el);var o=i.$current.drag.offset();i.$clones.show().css({top:o.top,left:o.left}).append(i.$current.drag.clone()),i.$current.drag.css("visibility","hidden"),this.vars.graspPosDiffX=o.left-e.pageX,this.vars.graspPosDiffY=o.top-e.pageY,console.log("X : "+this.vars.graspPosDiffX,"Y : "+this.vars.graspPosDiffY),i.$body.on("mousemove.ndd_draggable",this.mousemove),console.groupEnd()},nDragDrop.draggable.prototype.mousemove=function(e){i.$clones.css({top:e.pageY+this.vars.graspPosDiffY,left:e.pageX+this.vars.graspPosDiffX})},nDragDrop.draggable.prototype.mouseup=function(e){null!=i.$current.drag&&(console.group("mouseup"),i.$body.off("mousemove.ndd_draggable"),i.$clones.hide().empty(),i.$current.drag.css("visibility","visible"),i.$current.drag=null,console.groupEnd())},nDragDrop.droppable=function(e){_.bindAll(this,"init","mouseenter","mouseleave","mouseup"),this.init(e)},nDragDrop.droppable.prototype.init=function(e){this.opts=u.extend({},e),console.group("droppable init"),console.log(this.opts),i.common=i.common||new o,this.$el=u(this.opts.el),this.$el.addClass("ndd_drop").on({mouseenter:this.mouseenter,mouseleave:this.mouseleave,mouseup:this.mouseup}),console.groupEnd()},nDragDrop.droppable.prototype.mouseenter=function(e){null!=i.$current.drag&&(console.log("ndd.$current.drag",i.$current.drag),i.$current.drop=u(e.currentTarget),console.log("ndd.$current.drop",i.$current.drop),1!=i.$current.drag.closest(i.$current.drop).length&&i.$current.drop.addClass("ndd_drop_active"))},nDragDrop.droppable.prototype.mouseleave=function(e){null!=i.$current.drop&&(console.group("drop mouseleave"),i.$current.drop.removeClass("ndd_drop_active"),i.$current.drop=null,console.groupEnd())},nDragDrop.droppable.prototype.mouseup=function(e){null!=i.$current.drop&&(this.mouseleave(e),console.group("drop mouseup"),console.log("ndd.$current.drag",i.$current.drag),console.groupEnd())},e.nSelectable=function(e){_.bindAll(this,"init","mousedown","mousemove","mouseup"),this.init(e)},nSelectable.prototype.init=function(e){this.opts=u.extend({selectee:"> *",excluse:null},e),i.common=i.common||new o,console.group("nSelectable init"),this.vars={startPosX:0,startPosY:0},this.$selectee,this.$selected,this.$el=u(this.opts.el),i.$current.select=null,this.$helper=u('<div id="ndd_selectable_helper"><div></div></div>'),i.$body.on("mousedown.ndd_selectable",this.opts.el,this.mousedown),i.$body.on("mousemove.ndd_selectable",this.mousemove),i.$body.on("mouseup.ndd_selectable",this.mouseup),this.opts.excluse&&i.$body.on("mousedown",this.opts.excluse,this.excluse),console.groupEnd()},nSelectable.prototype.excluse=function(e){console.count("excluse"),e.preventDefault(),e.stopPropagation()},nSelectable.prototype.mousedown=function(e){console.count("selectable mousedown"),i.$current.select=u(e.currentTarget),console.log("ndd.$current.select",i.$current.select),this.vars.startPosX=e.pageX,this.vars.startPosY=e.pageY,i.$body.append(this.$helper),this.$helper.css({top:e.pageY,left:e.pageX,width:0,height:0}),this.$selectee=i.$current.select.find(this.opts.selectee),console.log("this.$selectee",this.$selectee)},nSelectable.prototype.mousemove=function(e){if(null!=i.$current.select){console.count("selectable mousemove");var o,s=this,t=this.vars.startPosX,n=this.vars.startPosY,r=e.pageX,l=e.pageY;r<t&&(o=r,r=t,t=o),l<n&&(o=l,l=n,n=o),this.$helper.css({left:t,top:n,width:r-t,height:l-n}),this.$selectee.each(function(e,o){var t=u(o);t[function(e,o){var t=e.get(0).getBoundingClientRect(),s=o.get(0).getBoundingClientRect();return!(t.right<s.left||t.left>s.right||t.bottom<s.top||t.top>s.bottom)}(t,s.$helper)?"addClass":"removeClass"]("ndd_selected")})}},nSelectable.prototype.mouseup=function(e){console.count("selectable mouseup"),i.$current.select=null,this.$helper.remove(),console.log("this.$helper",this.$helper)}}(jQuery,this,this.document);